<!-- History Panel Component -->
<div class="history-panel">  <!-- App Header -->
  <div class="app-header">
    <h2 class="app-title">
      <tabler-icon name="microphone" [size]="20" class="inline-icon"></tabler-icon>
      AI-TTS-MP3
    </h2>
    <p class="app-subtitle">Text to MP3 conversion</p>
  </div>

  <!-- Header -->
  <div class="history-header">    <div class="header-content">      <h3 class="panel-title">
        <tabler-icon name="archive" [size]="18" class="inline-icon"></tabler-icon>
        History
        <span class="item-count">({{ storageInfo().itemCount }})</span>
      </h3>
    </div>

    <!-- Storage Indicator -->
    <div class="storage-info" [class]="storageWarningLevel()">
      <div class="storage-bar">
        <div 
          class="storage-fill" 
          [style.width.%]="storageDisplayPercentage()">
        </div>
      </div>
      <div class="storage-text">
        <span class="storage-percentage">{{ storageDisplayPercentage() }}%</span>
        <span class="storage-details">{{ formatFileSize(storageInfo().used) }} / {{ formatFileSize(storageInfo().total) }}</span>
      </div>
      @if (storageWarningLevel() === 'warning') {
        <div class="storage-warning">
          <tabler-icon name="alert-triangle" [size]="16" class="inline-icon"></tabler-icon>
          Storage approaching limit
        </div>
      }      @if (storageWarningLevel() === 'critical') {
        <div class="storage-warning critical">
          <tabler-icon name="alert-circle" [size]="16" class="inline-icon"></tabler-icon>
          Storage critically full
        </div>
      }
    </div>

    <!-- Search -->
    <div class="search-container">
      <input 
        type="text" 
        class="search-input"
        placeholder="Search history..."
        [(ngModel)]="searchQuery"
        [value]="searchQuery()">
      @if (searchQuery()) {        <button 
          class="clear-search-btn" 
          (click)="searchQuery.set('')"
          title="Clear search">
          <tabler-icon name="x" [size]="14"></tabler-icon>
        </button>
      }
    </div>

    <!-- Clear All Button -->
    @if (history().length > 0) {      <button 
        class="clear-all-btn" 
        (click)="clearAllHistory()"
        title="Clear all history">
        <tabler-icon name="trash" [size]="16" class="inline-icon"></tabler-icon>
        Clear All
      </button>
    }
  </div>

  <!-- History List -->
  <div class="history-content">
      @if (filteredHistory().length === 0) {        <div class="empty-state">
          @if (searchQuery()) {
            <div class="empty-icon">
              <tabler-icon name="search" [size]="48" color="#6c757d"></tabler-icon>
            </div>
            <div class="empty-message">No items match your search</div>
          } @else {
            <div class="empty-icon">
              <tabler-icon name="scroll" [size]="48" color="#6c757d"></tabler-icon>
            </div>
            <div class="empty-message">No TTS history yet</div>
            <div class="empty-hint">Generated speech will appear here</div>
          }
        </div>
      } @else {
        <div class="history-list">
          @for (item of filteredHistory(); track item.id) {
            <div 
              class="history-item" 
              [class.selected]="selectedItemId() === item.id"
              (click)="selectItem(item)">
              
              <!-- Item Header -->
              <div class="item-header">                <div class="item-meta">
                  <span class="provider-info">
                    <tabler-icon [name]="getProviderIcon(item.settings.provider)" [size]="14" class="inline-icon"></tabler-icon>
                    {{ item.settings.provider | titlecase }}
                  </span>
                  <span class="voice-info">
                    <tabler-icon [name]="getVoiceIcon(item.settings.voice)" [size]="14" class="inline-icon"></tabler-icon>
                    {{ item.settings.voice | titlecase }}
                  </span>
                </div>
                <div class="item-date">{{ formatDate(item.createdAt) }}</div>
              </div>

              <!-- Item Content -->
              <div class="item-content">
                @if (item.metadata?.title) {
                  <div class="item-title">{{ item.metadata?.title || 'Untitled' }}</div>
                }
                <div class="item-text">{{ truncateText(item.text, 120) }}</div>                @if (item.metadata && item.metadata.tags && item.metadata.tags.length > 0) {
                  <div class="item-tags">
                    @for (tag of item.metadata.tags; track tag) {
                      <span class="tag">{{ tag }}</span>
                    }
                  </div>
                }
              </div>

              <!-- Item Footer -->
              <div class="item-footer">                <div class="item-info">
                  <span class="file-size">{{ formatFileSize(item.audioSize) }}</span>
                  @if (item.metadata && item.metadata.duration) {
                    <span class="duration">{{ item.metadata.duration }}s</span>
                  }
                </div>
                
                <div class="item-actions">                <button 
                  class="item-action-btn play-btn" 
                  (click)="playHistoryItem(item, $event)"
                  title="Play audio">
                  <tabler-icon name="player-play" [size]="14"></tabler-icon>
                </button>                <button 
                  class="item-action-btn download-btn" 
                  (click)="downloadHistoryItem(item, $event)"
                  title="Download audio">
                  <tabler-icon name="download" [size]="14"></tabler-icon>
                </button>                <button 
                  class="item-action-btn delete-btn" 
                  (click)="deleteItem(item, $event)"
                  title="Delete item">
                  <tabler-icon name="trash" [size]="14"></tabler-icon>
                </button>
              </div>
            </div>
          </div>        }
      </div>
    }
  </div>

  <!-- Clear All Confirmation Modal -->
  @if (showClearModal()) {
    <div class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Clear All History</h3>
          <button class="modal-close-btn" (click)="cancelClearAll()">
            <tabler-icon name="x" [size]="20"></tabler-icon>
          </button>
        </div>
        <div class="modal-body">
          <div class="modal-icon">
            <tabler-icon name="alert-triangle" [size]="48" color="#dc3545"></tabler-icon>
          </div>
          <p>Are you sure you want to clear all TTS history?</p>
          <p class="modal-warning">This action cannot be undone and will permanently delete {{ storageInfo().itemCount }} items.</p>
        </div>
        <div class="modal-footer">
          <button class="modal-btn secondary" (click)="cancelClearAll()">
            Cancel
          </button>
          <button class="modal-btn danger" (click)="confirmClearAll()">
            <tabler-icon name="trash" [size]="16" class="inline-icon"></tabler-icon>
            Clear All
          </button>
        </div>
      </div>
    </div>
  }
</div>
